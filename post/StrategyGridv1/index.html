<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>ç½‘æ ¼äº¤æ˜“ | ä¹±è°ˆåºœ      â€”â€”è©¹è©¹ç¢è¨€</title>

<link rel="shortcut icon" href="https://blog.laffitto.xyz/favicon.ico?v=1741015572497">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.laffitto.xyz/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160641909-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'UA-160641909-1');
    </script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            ä¹±è°ˆåºœ      â€”â€”è©¹è©¹ç¢è¨€
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            ğŸ¯é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            âœ‰å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            â˜æ ‡ç­¾äº‘é›†
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="https://memo.laffitto.xyz/" class="menu gt-a-link">
                            ğŸ’Œè©¹è©¹ç¢è¨€
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            ğŸ“å…³äºä¸ç•™è¨€
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/friends" class="menu gt-a-link">
                            ğŸ‘«å‹é“¾
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1741015572497" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    ç½‘æ ¼äº¤æ˜“
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2024-11-29 Â·
                    </time>
                    
                        <a href="https://blog.laffitto.xyz/tag/2HKnlhG5I/" class="post-tags">
                            # æŠ•èµ„
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>é‡åŒ–äº¤æ˜“åˆå°è¯•</p>
<!-- more -->
<p>æœ¬æ–‡æ‰€æœ‰å†…å®¹å‡ä¸ºä¸ªäººè§è§£ã€‚ä»…è¡¨ç¤ºè‡ªå·±åœ¨å½“å‰è®¤çŸ¥æƒ…å†µä¸‹è‡ªè®¤ä¸ºæ­£ç¡®çš„è§‚ç‚¹æ‰€ä½œå‡ºçš„è¡Œä¸ºï¼Œå¦‚æœ‰å¼‚è®®è¿˜è¯·è°…è§£ä¸æå‡ºäº¤æµã€‚å¤´å›¾æ¥è‡ª https://invest101.com.hk/grid-trading</p>
<h2 id="å¿ƒè·¯å†ç¨‹">å¿ƒè·¯å†ç¨‹</h2>
<p>è‡ªå·±ä¹Ÿç®—æ˜¯æŠ•èµ„å¸‚åœºå¤šå°‘å¹´çš„éŸ­èœäº†ï¼Œè™½ç„¶ç©çš„éƒ½æ˜¯å°é’±ï¼Œæœ€åç»Ÿè®¡ä¸‹æ¥è¿˜æ˜¯äºå¤šèµ¢å°‘ã€‚ä»¥å‰è¯»äº†ç‚¹å°ä¹¦ï¼Œçœ‹äº†ç‚¹å°æ–‡ç« ï¼Œç«‹é©¬è‡ªä¿¡å¿ƒçˆ†æ£šï¼Œè§‰å¾—å…¶ä»–äº¤æ˜“è€…éƒ½æ˜¯å®šåŠ›ä¸è¡Œï¼Œè‡ªå·±ä¸ä¼šè¢«å¸‚åœºçš„æƒ…ç»ªå·¦å³ã€‚äº¤æ˜“è¿‡ç¨‹å¤©å¤©è¯´å®šæŠ•ï¼Œç›¸ä¿¡æ—¶é—´çš„åŠ›é‡ï¼ŒæŠ•åˆ°åé¢èµ„é‡‘ä¸å¤Ÿï¼Œä¹Ÿä¸çŸ¥é“ä½•æ—¶æ­¢ç›ˆæ­¢æŸï¼Œçœ‹ç€èµšäº†ä»¥ä¸ºè‡ªå·±ç‰›é€¼ï¼Œçœ‹ç€è·Œäº†å°±é—­å˜´è£…æ­»ã€‚å½“ç„¶æˆ‘è¿™é‡Œä¸æ˜¯æŒ‡ä¸€äº›ä¼šå‘å‡ºä¿¡å·çš„ä¸»åŠ¨å‹åŸºé‡‘ï¼Œè€Œæ˜¯çº¯ç²¹è‡ªå·±è‡ªæˆ‘æ„ŸçŸ¥è‰¯å¥½çš„æ“ä½œï¼Œç°åœ¨å›é¦–çœ‹è¿‡å»ï¼Œæ²¡æœ‰æ˜ç¡®çš„ç³»ç»Ÿä¸ç›®çš„ï¼Œè¿›å…¥æŠ•èµ„å¸‚åœºæ— å¼‚äºèµŒåšã€‚</p>
<p>è¿‘å‡ ä¸ªæœˆå†³å®šè‡ªå·±åšä¸€ç‚¹é‡åŒ–çš„å°è¯•ï¼Œæ¯•ç«Ÿä¸€ä¸ªä¸œè¥¿é—¨æ§›è¶Šé«˜ï¼Œè¶Šå°‘çš„äººä¼šå»å°è¯•ã€‚èµ›é“è¶Šå°‘ï¼Œç«äº‰è¶Šå°‘ã€‚è™½ç„¶å¤§çš„æœºæ„ä¹Ÿä¼šæœ‰ä¸“é—¨çš„é‡åŒ–æŠ•èµ„éƒ¨é—¨ï¼Œä½†æ¯•ç«Ÿä¼šé¡¾è™‘åˆ°èµ„é‡‘å’Œé¢å‘å¸‚åœºç­‰å¤šæ–¹é¢å› ç´ ï¼Œå’Œä¸ªäººæŠ•èµ„è€…è¦è€ƒè™‘çš„ä¸œè¥¿å®Œå…¨ä¸ä¸€æ ·ã€‚å†µä¸”äººå®¶ä¹Ÿä¸ä¼šåˆ†äº«ç»™ä½ ä»–ä»¬çš„ç­–ç•¥ã€‚æŠ•èµ„è¦è¶æ—©ï¼Œæ—¢ç„¶è‡ªå·±æœ‰ä¸€å®šçš„èƒ½åŠ›ä¸åŸºç¡€ï¼Œæ—©ç‚¹ç ”ç©¶å°±å½“æ˜¯ç©ç©ä¹Ÿæ˜¯æœ‰è¶£çš„ã€‚</p>
<p>é‡åŒ–è¿‡ç¨‹ï¼Œç®€åŒ–æ¥è¯´å¤§ä½“å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ éƒ¨åˆ†ï¼šæ•°æ®æ”¶é›†ï¼Œç­–ç•¥æ„å»ºå’Œç­–ç•¥å›æµ‹ã€‚æ•°æ®æ”¶é›†å°±æ˜¯é€‰æ‹©åˆé€‚çš„å¹³å°ï¼Œèƒ½å¤ŸæŒç»­ç¨³å®šå‡†ç¡®çš„ç»™ä½ æä¾›æƒ³è¦ç ”ç©¶å¸‚åœºçš„æ•°æ®ã€‚ç­–ç•¥æ„å»ºæ˜¯é€‰æ‹©åˆé€‚çš„ç­–ç•¥æˆ–æ˜¯é€šè¿‡æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ è®­ç»ƒå¾—åˆ°ç­–ç•¥ã€‚ä¸åŒçš„ç­–ç•¥åŒæ ·æœ‰ç€ä¼—å¤šçš„è¶…å‚æ•°ï¼Œæ„å»ºä¸€ä¸ªåˆé€‚çš„æ¨¡å‹åŒæ ·éœ€è¦è€ƒè™‘å…¶å‡†ç¡®æ€§å’Œæ³›åŒ–æ€§ã€‚å›æµ‹è¿‡ç¨‹è€ƒè™‘æœ€ç»ˆçš„æŒ‡æ ‡ï¼Œå¯èƒ½æ˜¯å¤æ™®æ¯”ç‡ï¼Œåˆå¯èƒ½ä»…æ˜¯åˆ©æ¶¦ç‡ï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚æœ¬è´¨ä¸Šå’Œä¼—å¤šç§‘ç ”æµç¨‹ç±»ä¼¼ï¼Œæœ‰ç§‘å­¦ç ”ç©¶å†…å‘³äº†ã€‚</p>
<p>å¯¹äºä¸€ä¸ªç­–ç•¥æ¥è¯´ï¼Œæ ¸å¿ƒå…³é”®ç‚¹å°±æ˜¯ä¿¡å·ï¼ˆä½•æ—¶äº¤æ˜“ï¼‰å’Œæ•°é‡ã€‚åœ¨ä»€ä¹ˆæ—¶é—´ä¹°å…¥æˆ–å–å‡ºï¼Œäº¤æ˜“çš„è¿‡ç¨‹å…·ä½“æ•°é‡æ˜¯å¤šå°‘ã€‚ä¸€æ­¥æ­¥æ‹†è§£ä¸‹æ¥å°±æ˜¯ï¼šæ„å»ºå¥½è‡ªå·±çš„æ¡†æ¶ï¼Œæ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œé€‰æ‹©å¥½åˆé€‚çš„å“ç§ï¼ŒåŒæ—¶ä¿è¯å‡†ç¡®æ€§å’Œæ³›åŒ–æ€§ã€‚</p>
<p>æœ‰äº›äººç›¸ä¿¡ä»·å€¼æŠ•èµ„ï¼Œè¿›è¡ŒåŸºæœ¬é¢çš„ç ”ç©¶ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰è‡ªå·±çš„è®¤çŸ¥å’Œçœ¼å…‰è¿˜æ˜¯ä¸å¤Ÿï¼Œå†µä¸”æˆ‘ä¹Ÿæ‹¿ä¸åˆ°å•ä¸€å…¬å¸çœŸæ­£å†…éƒ¨çš„èµ„æ–™ï¼Œåˆä½•æ¥äº†è§£ä¸€è¯´ã€‚ç°é˜¶æ®µä¸å¦‚äº¤ç»™æœºå™¨å»é€‰æ‹©ï¼Œå°‘ä¸€ç‚¹è‡ªå·±çš„ä¸»è§‚èƒ½åŠ¨æ€§å§ã€‚</p>
<h2 id="ç½‘æ ¼äº¤æ˜“ç­–ç•¥">ç½‘æ ¼äº¤æ˜“ç­–ç•¥</h2>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ¢ç´¢ï¼ŒæŒæ¡äº†ä¸€äº›çš®æ¯›ï¼Œç›®å‰ä»ç„¶æœ‰è®¸å¤šçŸ¥è¯†ç›²ç‚¹ä¸ä¸“ä¸šæ€§çš„ä¸œè¥¿éœ€è¦æ…¢æ…¢é¢†ä¼šã€‚è¿™é‡Œå…ˆä»ç®€å•çš„å…¥æ‰‹å¤ç°ä¸€ä¸ªä»¥å‰ä½¿ç”¨è¿‡çš„ç½‘æ ¼äº¤æ˜“ç­–ç•¥ã€‚</p>
<p>ç½‘æ ¼äº¤æ˜“ä¸»è¦æ˜¯åœ¨éœ‡è¡ç¯å¢ƒä¸­éå¸¸æœ‰æ•ˆçš„ç­–ç•¥ã€‚éšç€è®¾å®šåˆé€‚çš„ä¹°å…¥å–å‡ºç½‘æ ¼åŒºé—´ï¼Œåœ¨åŒºé—´ä¸­åšåˆ°ä½ä»·ä¹°å…¥ï¼Œé«˜ä»·å–å‡ºï¼Œèµšä¸€ç‚¹ç‚¹ä¸­é—´çš„æ³¢åŠ¨ä»·æ ¼å·®ã€‚</p>
<p>åœ¨è¿›è¡Œç½‘æ ¼äº¤æ˜“ä¸­æœ‰ä»¥ä¸‹å…³é”®çš„ç‚¹ï¼š</p>
<ol>
<li>é€‰å®šåˆé€‚çš„å“ç§ã€‚ä¾‹å¦‚æŒ‡æ•°ç±» ETFï¼ˆæ²ªæ·± 300ï¼Œä¸­è¯ 500ï¼Œå…´å…¨è¶‹åŠ¿æ··åˆï¼Œåˆ›ä¸šæ¿æŒ‡ï¼‰ï¼Œè´¢åŠ¡ç¨³å®šçš„ï¼ˆé“¶è¡Œï¼Œä¿é™©ï¼‰ï¼Œå¯ä»¥é•¿æœŸæŒæœ‰çš„è‚¡ç¥¨ç­‰ç­‰ã€‚</li>
<li>é€‰å®šå¥½åˆé€‚çš„ä»·æ ¼åŒºé—´ã€‚ç­‰å·®åŒºé—´ï¼Œç­‰æ¯”åŒºé—´ï¼Œæˆ–æ˜¯å…¶ä»–æ›´å¤šçš„ç­–ç•¥ã€‚</li>
<li>åšå¥½å‹åŠ›æµ‹è¯•ï¼Œæå‰æ˜ç¡®å®šå¥½ä¸Šä¸‹åŒºé—´è¿›è¡Œæ­¢ç›ˆæ­¢æŸã€‚ä»¥åŠè¶…å‡ºåŒºé—´åå¦‚ä½•è¿›è¡Œåç»­æ“ä½œã€‚</li>
</ol>
<h2 id="ç­–ç•¥ç¼–å†™">ç­–ç•¥ç¼–å†™</h2>
<p>è¿™é‡Œé€‰æ‹©ä¹‹å‰å®æˆ˜ä¸­ä½¿ç”¨è¿‡çš„ä¸‡é©¬è‚¡ä»½ (SZSE:002276) ä½œä¸ºç ”ç©¶å¯¹è±¡ã€‚åç»­ä¼šå¯¹æ›´å¤šçš„å“ç§è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>å›æµ‹æ¡†æ¶ç»è¿‡å¤šæ–¹é¢å¯¹æ¯”ï¼Œæˆ‘é€‰æ‹©äº†ç°åœ¨åœ¨æŒç»­ç»´æŠ¤ä¸”è¿è¡Œæ•ˆç‡è¾ƒé«˜çš„ vectorbt çš„ä»˜è´¹ç‰ˆæœ¬ <a href="https://vectorbt.pro/">VectorBT PRO</a>ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€äº›å…è´¹çš„æ¡†æ¶å¦‚ <a href="https://github.com/vnpy/vnpy">vnpy</a>ã€‚</p>
<p>å¦‚ä¸‹ä»£ç åœ¨jupyter notebookä¸­è¿è¡Œï¼Œæš‚ä¸è€ƒè™‘ä¼˜åŒ–æ•ˆç‡å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä»…åˆæ­¥å±•ç¤ºå’Œå‚è€ƒã€‚<br>
å¯¼å…¥ç›¸å…³åº“</p>
<pre><code class="language-python">import vectorbtpro as vbt  
import numpy as np  
import pandas as pd
</code></pre>
<p>ä» tradingview æŠ“å–ç›¸å…³æ•°æ®ï¼Œä»¥å¤©ä¸ºå•ä½çš„Kçº¿</p>
<pre><code class="language-python">list_name = vbt.TVData.list_symbols(symbol_pattern=&quot;002276&quot;)  
data = vbt.TVData.pull(&quot;SZSE:002276&quot;)
data.stats()

è¾“å‡º
Start Index            2009-07-10 01:30:00+00:00
End Index              2024-11-13 01:30:00+00:00
Total Duration                3623 days 00:00:00
Total Symbols                                  1
Null Counts: 002276                            0
Name: agg_stats, dtype: object
</code></pre>
<p>é€‰å–ç‰¹å®šæ—¶é—´æ®µå¹¶å¯è§†åŒ–Kçº¿</p>
<pre><code class="language-python">close = data.get('Close')
data=data.loc['2018-01-01':]
data.plot().show()
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://picgo-1306089623.cos.ap-nanjing.myqcloud.com/202411281614777.png" alt="image.png" loading="lazy"></figure>
<p>å®šä¹‰ä¸€ä¸ªç­‰å·®ç½‘æ ¼åŒºé—´</p>
<pre><code class="language-python"># ç­‰å·®è®¡ç®— è¾“å…¥ä¸Šä¸‹åŒºé—´ï¼Œç›®æ ‡æŠ•å…¥é‡‘é¢ï¼Œè®¡åˆ’ç½‘æ ¼æ•° å¾—åˆ°æ¯æ ¼ä¹°å…¥ä»·æ ¼é—´éš”ï¼Œæ¯æ ¼ä¹°å…¥æ•°é‡  
def arithmetic_grid(price_low, price_high, initial_fund, grid_num):  
    # è®¡ç®—æ¯æ ¼ä»·æ ¼çš„å·®ä»·  
    grid_price_interval = round((price_high - price_low) / (grid_num-1),4)  
    # ç­‰å·®æ•°åˆ—è®¡ç®—å…¬å¼  
    total_multiplier = grid_num * (price_low + price_high) / 2  
    # è®¡ç®—æ¯æ ¼çš„äº¤æ˜“æ•°é‡ï¼Œä½¿å¾—æ€»å’Œç¬¦åˆåˆå§‹èµ„é‡‘  
    share_number = int(initial_fund / total_multiplier)  
    print(f&quot;æ¯æ ¼äº¤æ˜“ä»·æ ¼é—´éš”: {grid_price_interval}ï¼Œæ¯æ ¼äº¤æ˜“æ•°é‡: {share_number}&quot;)  
    # äº¤æ˜“é—´éš”  
    grid_interval = [round(price_low + i * grid_price_interval, 4) for i in range(grid_num)]  
    return grid_price_interval,share_number,grid_interval
</code></pre>
<p>è®¾å®šç½‘æ ¼æœ€ä½ä»·ä»·ä¸º 6ï¼Œæœ€é«˜ä»·æ ¼ 12ï¼Œæ€»è®¡åˆ’æŠ•å…¥é‡‘é¢ 10000ï¼Œç½‘æ ¼æ•°é‡ 10</p>
<pre><code class="language-python">grid_price, grid_amount, grid_interval = arithmetic_grid(price_low=6, price_high=12, initial_fund=10000, grid_num=10)  
grid_interval

è¾“å‡ºï¼š
æ¯æ ¼äº¤æ˜“ä»·æ ¼é—´éš”: 0.6667ï¼Œæ¯æ ¼äº¤æ˜“æ•°é‡: 111
[6.0,
 6.6667,
 7.3334,
 8.0001,
 8.6668,
 9.3335,
 10.0002,
 10.6669,
 11.3336,
 12.0003]

</code></pre>
<h4 id="gridv1">Gridv1</h4>
<p>å®šä¹‰æœ€åŸºæœ¬ç®€å•çš„ç½‘æ ¼äº¤æ˜“ç­–ç•¥ï¼šé‡‡ç”¨æ¯æ¬¡äº¤æ˜“ç›¸åŒæ•°é¢ï¼Œè¾“å‡º direction è¡¨ç¤ºä¹°å–ä¿¡å·ï¼Œè¾“å‡º grid_interval è¡¨ç¤ºç½‘æ ¼é—´éš”ï¼Œä»…ç”¨äºå¯è§†åŒ–ã€‚</p>
<pre><code class="language-python">## é’ˆå¯¹è‚¡ç¥¨ä¹°å…¥ç‰¹å®šä»½æ•°  
## æ¯ä¸€æ¬¡ä¹°å…¥å–å‡ºéƒ½ä¼šé‡ç½®åŸºå‡†å•ä½  
  
# ç­–ç•¥åœ¨æ‰§è¡Œä¹‹å‰å…ˆä¹°å…¥ä¸€å®šæ¯”ä¾‹ï¼Œåç»­ä½¿ç”¨ç½‘æ ¼è¿›è¡Œäº¤æ˜“æµ‹ç®—ã€‚å¦‚æœåŸºé‡‘å‘ˆç°ä¸Šæ¶¨è¶‹åŠ¿ï¼Œå»ºä»“æ¯”ä¾‹è¾ƒå¤§å¯ä»¥åƒåˆ°æ›´å¤šåˆ©æ¶¦  
# init_position åˆå§‹å»ºä»“ä»½æ•°  
# init_price å»ºä»“æ—¶ä»·æ ¼  
# position_size å·²å»ºä»“çš„é‡‘é¢  
# remain_cash ç”¨äºæ‰§è¡Œç½‘æ ¼çš„é‡‘é¢  
# units æŒæœ‰çš„ä»“ä½  
# base_unit_price åŸºå‡†ä¹°å…¥ä»·æ ¼  
# today_unit_price å½“æ—¥ä»·æ ¼  
  
def stock_grid_line_v1(close, remain_cash, init_position,price_low=6, price_high=12):  
      
    init_price = close.iloc[0]  
    units = init_position    
      
    base_unit_price = close.iloc[0]  
    direction = pd.Series(np.full(data.shape[0], 0), index=data.index)  
    # size = pd.Series(np.full(data.shape[0], 0), index=data.index)  
    # è®¡ç®—ç½‘æ ¼å¤§å°å’Œæ¯æ ¼äº¤æ˜“æ•°é‡ï¼Œé‡‡ç”¨ç­‰å·®æ–¹å¼  
    grid_price, grid_amount,grid_interval = arithmetic_grid(price_low=price_low, price_high=price_high, initial_fund=remain_cash, grid_num=10)  
    print(f&quot;åˆå§‹ä¹°å…¥ä»·æ ¼{init_price}&quot;)  
      
    for i in range(1, close.shape[0]):  
        today_unit_price = close.iloc[i]  
          
        # è¶…å‡ºäº¤æ˜“åŒºé—´ä¸åšäº¤æ˜“  
        if today_unit_price&lt;price_low or today_unit_price &gt; price_high:  
            continue  
        ## sold operation  
        # å½“æ—¥ä»·æ ¼é«˜äºç½‘æ ¼ä»·ï¼Œä¸”æ‰‹é‡Œæœ‰æŒä»“æœ‰å‰©ä½™  
        if today_unit_price &gt;= base_unit_price+grid_price and units &gt;= grid_amount:  
            units -= grid_amount  
            remain_cash += grid_amount*today_unit_price  
            direction.iloc[i] = -1  
            #é‡ç½®åŸºå‡†å•ä½  
            base_unit_price = today_unit_price  
              
        ## buy operation  
        # å½“æ—¥ä»·æ ¼ä½äºç½‘æ ¼ä»·ï¼Œä¸”æ‰‹é‡Œæœ‰ç°é‡‘  
        if today_unit_price &lt;= base_unit_price-grid_price and remain_cash &gt;= grid_amount*today_unit_price:  
            units += grid_amount  
            remain_cash -= grid_amount*today_unit_price  
            direction.iloc[i] = 1  
            #é‡ç½®åŸºå‡†å•ä½  
            base_unit_price = today_unit_price  
  
                         
    return direction,grid_interval
</code></pre>
<p>è®¾å®šæ€»è®¡åˆ’æœ€å¤šæŠ•å…¥é‡‘é¢ 10000ï¼Œåˆå§‹å»ºä»“ 400 è‚¡</p>
<pre><code class="language-python">direction,grid_interval = stock_grid_line_v1(close,10000,400)

è¾“å‡ºï¼š
æ¯æ ¼äº¤æ˜“ä»·æ ¼é—´éš”: 0.6667ï¼Œæ¯æ ¼äº¤æ˜“æ•°é‡: 111
åˆå§‹ä¹°å…¥ä»·æ ¼8.7
</code></pre>
<p>å¯è§†åŒ–</p>
<pre><code class="language-python">def plot_entry_exit(close, entries, exits, basic_line, grid_interval):  
    fig = close.vbt.plot()  
    entries.vbt.signals.plot_as_entries(close, fig=fig)  
    exits.vbt.signals.plot_as_exits(close, fig=fig)  
    fig.add_shape(  
        type=&quot;line&quot;,  
        x0=0, x1=1,  # æ¨ªåæ ‡èŒƒå›´ï¼Œ0åˆ°1è¡¨ç¤ºæ•´ä¸ªxè½´çš„å®½åº¦  
        y0=basic_line, y1=basic_line,  # y0=y1=7 è¡¨ç¤ºæ°´å¹³çº¿ä½ç½®  
        xref='paper',  # ä½¿ç”¨ 'paper' å‚è€ƒç³»ç¡®ä¿çº¿æ¡å»¶ä¼¸åˆ°æ•´ä¸ªå›¾å®½  
        line=dict(color=&quot;Red&quot;, width=2, dash=&quot;dash&quot;)  # è®¾ç½®çº¿æ¡é¢œè‰²ã€å®½åº¦å’Œæ ·å¼  
    )  
    for interval in grid_interval:  
        fig.add_shape(  
        type=&quot;line&quot;,  
        x0=0, x1=1,  # æ¨ªåæ ‡èŒƒå›´ï¼Œ0åˆ°1è¡¨ç¤ºæ•´ä¸ªxè½´çš„å®½åº¦  
        y0=interval, y1=interval,  # y0=y1=7 è¡¨ç¤ºæ°´å¹³çº¿ä½ç½®  
        xref='paper',  # ä½¿ç”¨ 'paper' å‚è€ƒç³»ç¡®ä¿çº¿æ¡å»¶ä¼¸åˆ°æ•´ä¸ªå›¾å®½  
        line=dict(color=&quot;Blue&quot;, width=2, dash=&quot;dash&quot;)  # è®¾ç½®çº¿æ¡é¢œè‰²ã€å®½åº¦å’Œæ ·å¼  
    )  
    print(f'ä¹°å…¥ç‚¹æ•°é‡{entries.vbt.signals.total()},å–å‡ºç‚¹æ•°é‡{exits.vbt.signals.total()}')  
    return fig.show()
</code></pre>
<p>ç”±äºæ—¶é—´æœ‰ä¸€å®šæ»åæ€§ï¼Œé»˜è®¤ä¸ºå¾—åˆ°äº¤æ˜“ä¿¡å·åä¸€å¤©æ‰å¼€å§‹äº¤æ˜“ã€‚</p>
<pre><code class="language-python"># å®é™…æ“ä½œä¹°å…¥å–å‡ºæ—¶é—´å‘åæ¨è¿Ÿä¸€ä¸ªå•ä½
entries = (direction == 1).vbt.signals.fshift() 
exits = (direction == -1).vbt.signals.fshift()
plot_entry_exit(close,entries,exits,basic_line=close.iloc[0],grid_interval=grid_interval)
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://picgo-1306089623.cos.ap-nanjing.myqcloud.com/202411281645243.png" alt="image.png" loading="lazy"></figure>
<p>è¿›è¡Œå®é™…å›æµ‹ï¼Œè¿™é‡Œä¸»è¦ä¾èµ–vectorbtè‡ªå¸¦çš„å›æµ‹æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨å³å¯ã€‚å¿½ç•¥æ‰‹ç»­è´¹ã€‚</p>
<pre><code class="language-python">pf = vbt.Portfolio.from_signals(  
    close=close,   
    entries=entries,   
    exits=exits,   
    init_cash=10000, # åˆå§‹èµ„é‡‘  
    init_position= 400, #åˆå§‹ä»“ä½  
    init_price = close.iloc[0], #åˆå§‹å»ºä»“é‡‘é¢  
    size=111, # ä½¿ç”¨amountç±»å‹ï¼Œæ¯æ¬¡è¿›è¡Œå›ºå®šè‚¡æ•°çš„äº¤æ˜“  
    size_type=&quot;amount&quot;,  
    # fees=0.001,  
    accumulate=True,  
)
pf.stats()
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://picgo-1306089623.cos.ap-nanjing.myqcloud.com/202411281649054.png" alt="image.png" loading="lazy"></figure>
<p>è¾“å‡ºè§£æ</p>
<ul>
<li>Total Return æœ€ç»ˆæŠ•èµ„åˆ©æ¶¦å¢é•¿</li>
<li>Benchmark Return åŸºçº¿æ”¶ç›Šï¼ˆä¸€ç›´æŒæœ‰æ”¶ç›Šï¼‰</li>
<li>Total Time Exposure æ€»æš´éœ²åœ¨å¸‚åœºä¸­çš„æ—¶é—´</li>
<li>Max Gross Exposure æœ€å¤§äº¤æ˜“ä¸­ä½¿ç”¨çš„ç°é‡‘é‡</li>
<li>Max Drawdown æœ€å¤§å›æ’¤ï¼Œå³ç»„åˆä»·å€¼åœ¨åˆ›ä¸‹æ–°é«˜åä¸‹è·Œçš„æœ€å¤§è·ç¦»</li>
<li>Total Orders æ€»è®¢å•æ¬¡æ•°</li>
<li>Total Trades æ€»äº¤æ˜“æ¬¡æ•°ã€‚Vectorbt ä¸­ä»…å–å‡ºæ“ä½œè®¡ä½œäº¤æ˜“ã€‚ä¸€æ—¦å–å‡ºè®¢å•è¢«æ‰§è¡Œï¼ˆé€šè¿‡å‡å°‘æˆ–å…³é—­ positionï¼‰ï¼Œå°±ä¼šæ ¹æ®åŠ æƒå¹³å‡è¿›å…¥å’Œé€€å‡ºä»·æ ¼è®¡ç®—æŸç›Š (the profit and loss, PnL)</li>
<li>Win Rate äº¤æ˜“ï¼ˆå–å•ï¼‰äº§ç”Ÿåˆ©æ¶¦çš„æ¦‚ç‡</li>
<li>Best Trade æœ€å¥½äº¤æ˜“çš„åˆ©æ¶¦ç‡</li>
<li>Worst Trade æœ€å·®äº¤æ˜“çš„åˆ©æ¶¦ç‡</li>
<li>Profit Factor åˆ©æ¶¦å› å­</li>
<li>Expectancy é¢„æœŸ average profitability å¹³å‡ç›ˆåˆ©èƒ½åŠ›</li>
</ul>
<p>å›æŠ¥ç‡ 25%ï¼Œè¿˜æ˜¯å¯ä»¥çš„ã€‚</p>
<h3 id="gridv2">Gridv2</h3>
<p>ç®€å•æ”¹è¿›ä¸€ä¸‹ç½‘æ ¼ç­–ç•¥ï¼šæ¯æ¬¡äº¤æ˜“ç½‘æ ¼åï¼Œä¸‹ä¸€ä¸ªç½‘æ ¼æŒ‰ç…§ä¸€å®šæ¯”ä¾‹å¢åŠ ä»½é¢ã€‚è¾“å‡ºå¤šå¢åŠ ä¸€ä¸ª size ï¼Œè¡¨ç¤ºäº¤æ˜“çš„æ•°é‡</p>
<pre><code class="language-python">## é’ˆå¯¹è‚¡ç¥¨ä¹°å…¥ç‰¹å®šä»½æ•°  
## æ¯ä¸€æ¬¡ä¹°å…¥å–å‡ºéƒ½ä¼šé‡ç½®åŸºå‡†å•ä½  
## å¤§ç½‘æ ¼å¢åŠ ä»½é¢ã€‚  
  
# ç­–ç•¥åœ¨æ‰§è¡Œä¹‹å‰å…ˆä¹°å…¥ä¸€å®šæ¯”ä¾‹ï¼Œåç»­ä½¿ç”¨ç½‘æ ¼è¿›è¡Œäº¤æ˜“æµ‹ç®—ã€‚
# init_position åˆå§‹å»ºä»“ä»½æ•°  
# init_price å»ºä»“æ—¶ä»·æ ¼  
# position_size å·²å»ºä»“çš„é‡‘é¢  
# remain_cash ç”¨äºæ‰§è¡Œç½‘æ ¼çš„é‡‘é¢  
# units æŒæœ‰çš„ä»“ä½  
# base_unit_price åŸºå‡†ä¹°å…¥ä»·æ ¼  
# today_unit_price å½“æ—¥ä»·æ ¼  
  
def stock_grid_line_v2(close, remain_cash, init_position,price_low=6, price_high=12):  
    init_price = close.iloc[0]  
    units = init_position  
  
    base_unit_price = close.iloc[0]  
    direction = pd.Series(np.full(data.shape[0], 0), index=data.index)  
    size = pd.Series(np.full(data.shape[0], 0), index=data.index)  
  
    # è®¡ç®—ç½‘æ ¼å¤§å°å’Œæ¯æ ¼äº¤æ˜“æ•°é‡ï¼Œé‡‡ç”¨ç­‰å·®æ–¹å¼  
    grid_price, grid_amount, grid_interval = arithmetic_grid(price_low=price_low, price_high=price_high, initial_fund=remain_cash,  
                                                             grid_num=10)  
    print(f&quot;åˆå§‹ä¹°å…¥ä»·æ ¼{init_price}&quot;)  
  
    # è®°å½•æ“ä½œä½ç½®  
    position_grid = 0  
    # å¢åŠ ç½‘æ ¼ä»½é¢   
    grid_amount_increase = int(grid_amount * 0.02)  
    print(f&quot;ç½‘æ ¼å¢åŠ æ•°é‡{grid_amount_increase}&quot;)  
  
    for i in range(1, close.shape[0]):  
        today_unit_price = close.iloc[i]  
        buy_grid_amount = grid_amount + grid_amount_increase * position_grid  
        sell_grid_amount = grid_amount + grid_amount_increase * position_grid  
          
        # è¶…å‡ºäº¤æ˜“åŒºé—´ä¸åšäº¤æ˜“  
        if today_unit_price&lt;price_low or today_unit_price &gt; price_high:  
            continue  
  
        ## sold operation  
        # å½“æ—¥ä»·æ ¼é«˜äºç½‘æ ¼ä»·ï¼Œä¸”æ‰‹é‡Œæœ‰æŒä»“æœ‰å‰©ä½™  
        if today_unit_price &gt;= base_unit_price + grid_price and units &gt;= sell_grid_amount:  
            units -= sell_grid_amount  
            remain_cash += sell_grid_amount * today_unit_price  
            direction.iloc[i] = -1  
            size.iloc[i] = sell_grid_amount  
  
            # é‡ç½®è°ƒæ•´åŸºå‡†  
            base_unit_price = today_unit_price  
            position_grid -= 1  
  
        ## buy operation  
        # å½“æ—¥ä»·æ ¼ä½äºç½‘æ ¼ä»·ï¼Œä¸”æ‰‹é‡Œæœ‰ç°é‡‘  
        if today_unit_price &lt;= base_unit_price - grid_price and remain_cash &gt;= buy_grid_amount * today_unit_price:  
            units += buy_grid_amount  
            remain_cash -= buy_grid_amount * today_unit_price  
            direction.iloc[i] = 1  
            size.iloc[i] = buy_grid_amount  
  
            # é‡ç½®è°ƒæ•´åŸºå‡†  
            base_unit_price = today_unit_price  
            position_grid += 1  
  
    return direction, size, grid_interval
</code></pre>
<p>é€‰å–å’Œä¹‹å‰ç›¸åŒçš„å‚æ•°æ¨¡æ‹Ÿ</p>
<pre><code class="language-python">direction, input_size, grid_interval = stock_grid_line_v2(close,10000,400)

è¾“å‡ºï¼š
æ¯æ ¼äº¤æ˜“ä»·æ ¼é—´éš”: 0.6667ï¼Œæ¯æ ¼äº¤æ˜“æ•°é‡: 111
åˆå§‹ä¹°å…¥ä»·æ ¼8.7
ç½‘æ ¼å¢åŠ æ•°é‡5
</code></pre>
<p>å¯è§†åŒ–</p>
<pre><code class="language-python">entries = (direction == 1).vbt.signals.fshift() 
exits = (direction == -1).vbt.signals.fshift()
# ä¼ å…¥çš„æ¯æ¬¡äº¤æ˜“æ•°é‡ä¹Ÿéœ€è¦ç§»ä½  
input_size = input_size.shift(1, fill_value=0)
plot_entry_exit(close,entries,exits,basic_line=close.iloc[0],grid_interval=grid_interval)
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://picgo-1306089623.cos.ap-nanjing.myqcloud.com/202411282227673.png" alt="image.png" loading="lazy"></figure>
<p>å›æµ‹</p>
<pre><code class="language-python">def signal_func_nb_v2(c, long_signals, short_signals, size,input_sizes):  
    long_signal = vbt.pf_nb.select_nb(c, long_signals)  
    short_signal = vbt.pf_nb.select_nb(c, short_signals)  
    input_size = vbt.pf_nb.select_nb(c, input_sizes)  
    if long_signal:  
        print(f'buy {input_size} amount')  
        size[0, c.col] = input_size  
    if short_signal:  
        print(f'sell {input_size} amount')  
        size[0, c.col] = input_size  
    return long_signal, False, short_signal, False  
pf = vbt.Portfolio.from_signals(  
    close=close,   
    init_cash=10000, # åˆå§‹èµ„é‡‘  
    init_position= 400, #åˆå§‹ä»“ä½  
    init_price = close.iloc[0], #åˆå§‹å»ºä»“é‡‘é¢  
    signal_func_nb=signal_func_nb_v2,  
    signal_args=(  
        vbt.Rep(&quot;long_signals&quot;),   
        vbt.Rep(&quot;short_signals&quot;),   
        vbt.Rep(&quot;size&quot;),  
        vbt.Rep(&quot;input_sizes&quot;)      
    ),  
    size=vbt.RepEval(&quot;np.full((1, wrapper.shape_2d[1]), np.nan)&quot;),    
    size_type=&quot;amount&quot;,  
    accumulate=True,  
    broadcast_named_args=dict(  
        long_signals= entries,  
        short_signals=exits,  
        input_sizes=input_size,  
    ),  
    jitted = False  
)
pf.stats()
</code></pre>
<p><img src="https://picgo-1306089623.cos.ap-nanjing.myqcloud.com/202411282229197.png" alt="image.png" loading="lazy"><br>
å°±å›æŠ¥ç‡è€Œè¨€æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œä½†æ˜¯å…¶ä»–æŒ‡æ ‡æœ‰æ‰€æå‡ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç­–ç•¥çš„è¶…å‚æ•°å¾ˆå¤šï¼Œç½‘æ ¼ä¸Šä¸‹é™ï¼Œç½‘æ ¼æ•°é‡ï¼Œå‡†å¤‡æŠ•å…¥é‡‘é¢ï¼Œåˆå§‹å»ºä»“æ•°é‡ï¼Œéƒ½å¯ä»¥é€‰å–æ”¹å˜ã€‚å†µä¸”å°±è‚¡ç¥¨å¸‚åœºæ¥è¯´ï¼Œä¹°å…¥çš„æ•°é‡åŸºæœ¬éƒ½æ˜¯ä»¥1æ‰‹ä¸ºå•ä½ï¼Œä¸Šè¿°çš„111äº¤æ˜“ä»½é¢å®é™…ä¸ç¬¦åˆé¢„æœŸã€‚</p>
<p>ç­–ç•¥ä¹Ÿæœ‰å¾ˆå¤šä¼˜åŒ–ç©ºé—´ï¼Œæ¯”å¦‚å…¥åœºæ—¶æœºæˆ–è®¸å¯ä»¥é€‰æ‹©ä¸€äº›å‚æ•°è”åˆåˆ¤æ–­ï¼ˆå¦‚ EMA ï¼ŒRSI ç­‰ï¼‰ã€‚</p>
<p>Vectorbt çš„ä¼˜åŠ¿å°±åœ¨äºèƒ½å¤Ÿå¿«é€Ÿçš„éå†æµ‹è¯•å¤§è§„æ¨¡æ•°æ®çš„æƒ…å†µï¼Œè¿›è€Œä»ä¸­é€‰å–åˆé€‚çš„è¶…å‚æ•°ã€‚è¿™é‡Œé™äºç¯‡å¹…å’Œè¿›åº¦ï¼Œå…ˆæš‚æ—¶åˆ†äº«ä¸Šè¿°å†…å®¹ã€‚</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://blog.laffitto.xyz/post/obsidian-hao-yong-ai-cha-jian/" class="post-title gt-a-link">
                    Obsidianå¥½ç”¨AIæ’ä»¶
                </a>
            </div>
        

        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'AnAyH2UNFKN6f5QhPUdWhX0P-MdYXbMMI',
		appKey: 'WB66M0LovKWi8iGgUlXB5xHM',
		avatar: '',
		pageSize: 5,
		recordIp: false,
		placeholder: 'Just Go Go',
		visitor: false,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">Aspire to inspire until I expire ğŸ¸
ä¹Ÿæ‰¯æ·¡ï¼Œä¹Ÿæ€è€ƒï¼Œä¹Ÿç”Ÿæ´»</div>
    <div class="social-container">
        
            
                <a href="https://github.com/laffitto" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://twitter.com/LaffitteRat" target="_blank">
                    <i class="fab fa-twitter gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
                <a href="https://t.me/laffitto" target="_blank">
                    <i class="fab fa-telegram gt-c-content-color-first"></i>
                </a>
            
        
            
        
    </div>
    <div class="footer-info">
        Copyright Â© Laffitto 2019|Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://blog.laffitto.xyz/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
